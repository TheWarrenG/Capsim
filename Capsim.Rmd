---
title: "Capsim"
author: "Warren Gu"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE, echo = FALSE}
library(readr)
library(stringr)
library(magrittr)
library(dplyr)
library(pdftools)
library(ggplot2)

get_scores <- function(summaries){
  roa <- numeric()
  roe <- numeric()
  cumulative_profit <- numeric()
  market_cap <- numeric()
  for (summary in summaries){
    roa <- c(roa, summary["ROA"])
    roe <- c(roe, summary["ROE"])
    cumulative_profit <- c(cumulative_profit, summary["Cumulative.Profit"])
    market_cap <- c(market_cap, summary["Market.Cap"])
  }
  list_mean <- function(stat_list){
    sum_of_vectors <- c(0, 0, 0, 0, 0, 0)
    for (v in stat_list){
      sum_of_vectors <- sum_of_vectors + unlist(v)
    }
    return(sum_of_vectors/length(stat_list))
  }
  roa_mean <- list_mean(roa)
  roe_mean <- list_mean(roe)
  final_profit <- cumulative_profit %>%
                    tail(., n=1)
  final_market_cap <- market_cap %>%
                    tail(., n=1)
  
  scores <- 0.25* ((roa_mean/max(roa_mean)) +
                     (roe_mean/max(roe_mean)) +
                     (final_profit[[1]]/max(final_profit[[1]])) +
                     (final_market_cap[[1]]/max(final_market_cap[[1]])))
  
  counter <- 0
  for (score in scores){
    counter <- counter + 1
    if (score < 0){
      scores[counter] <- 0
    }
  }
  return(scores)
}

import_pdf <- function(pdf_title){
  pdf_title %>%
    pdf_text() %>%
    summarize() %>%
    return()
}

products <- function(pdf_title, c){
  if (c == "Low"){
    n = 5
  }
  if(c == "High"){
    n = 6
  }
  page <- pdf_text(pdf_title)[[n]] %>%
    str_split('\n') %>%
    unlist()
  
  separate <- function(i){
    separated <- page[i] %>%
      str_split(., boundary("word")) %>%
      unlist()
    return(separated)
  }
  
  numbers <- function(i){
    stat_list <- separate(i) %>%
      grep("[0-9]", ., value = TRUE) %>%
      gsub("[,$]", "", .) %>%
      as.numeric()
    return(stat_list)
  }
  
  final = length(page) - 2
  names = character()
  performance = numeric()
  size = numeric()
  price = numeric()
  mtbf = numeric()
  age = numeric()
  awareness = numeric()
  accessibility = numeric()
  score = numeric()
  
  for (i in c(18:final)){
    names = c(names, separate(i)[1])
    performance = c(performance, numbers(i)[6])
    size = c(size, numbers(i)[7])
    price = c(price, numbers(i)[8])
    mtbf = c(mtbf, numbers(i)[9])
    age = c(age, numbers(i)[10])
    awareness = c(awareness, numbers(i)[12]/100)
    accessibility = c(accessibility, numbers(i)[14]/100)
    score = c(score, numbers(i)[15])
  }
  
  product_stats <- data.frame("Names" = names,
                              "Performance" = performance,
                              "Size" = size,
                              "Price" = price,
                              "MTBF" = mtbf,
                              "Age" = age,
                              "Awareness" = awareness,
                              "Accessibility" = accessibility,
                              "Score" = score)
  
  return(product_stats)
}
round_four_high <- products("Round 4.PDF", "High")
round_four_low <- products("Round 4.PDF", "Low")
round_six_low <- products("Round 6.PDF", "Low")
round_six_high <- products("Round 6.PDF", "High")
round_two_high <- products("Round 2.PDF", "High")
round_two_low <- products("Round 2.PDF", "Low")
round_seven_low <- products("Round 7.PDF", "Low")
round_seven_high <- products("Round 7.PDF", "High")
```

### Introduction

Capsim is an online business simulation where a user is put in charge of a company. The user competes against up to five other companies in the aftermath of a monopoly breakup in the electronic sensor industry. For students taking the class UGBA 10 here at Berkeley, Capsim is a required activity which comprises 10% of the class' grade. Over eight years, the companies input decisions involving marketing spending, product pricing, and debt financing. For the purposes of the class, each company's performance is based on four categories:

* Average return on assets
* Average return on equity
* Cumulative profit
* Ending market capitalization

This project attempts to determine the market demand of a company's products in order to calculate the projected yearly income of the company.

### More Detailed Capsim Background

The data in this project comes from the Capsim Foundation simulation that I was a part of for the Spring 2018 UGBA 10 class. All data were PDF files generated by the simulation. In other Capsim simulations, it is possible to use Excel to upload company decisions, but the simulation that I was in only provided the PDF files. The simulation that I was part of also included an optional Human Resources module. Additionally, the TQM and Advance Marketing modules were not implemented, both of which could affect a product's market demand. On the other hand, the Human Resources module does not affect a product's market demand. This project will be restricted to the particular Capsim simulation factors found in the UGBA 10 course here at Berkeley.

### Product's Market Demand

In Capsim, market demand for a product is based on a score that the customers assigns to the product known as the customer survey score. The product's customer survey score depends on six factors:

* Price
* Performance and Size
* Age
* Reliabilitty(Mean Time Before Failure)
* Awareness
* Accessibility

Performance and size are two different characteristics, but the customer survey score combines the two characteristics to produce one component of the customer survey score. In the simulation, the customers look for an ideal value for each of the characteristic when assigning a score to a product. Products that have characteristics closer to the ideal values will have a higher customer survey score. For instance, below is a graph of several products' performance and size in the fourth year of a simulation. Each point represents a product, and the color of the product indicates the product's overall customer survey score.
```{r, echo = FALSE}
ggplot(data = round_four_low, aes(x=Performance, y=Size, fill = Score)) +
  geom_jitter(aes(colour = Score), alpha = .8, size = 2) +
  labs(title = "Capsim Round 4 Low-Tech Perceptual Map") +
  xlim(0, 20) +
  ylim(0, 20)
```

The plot shows points that are closer to the (6.8, 13.2) have a higher customer survey score as we expect. However, performance and size are special because the ideal value changes every year. Let us compare the graph for the second year of the simulation and the seventh year of the simulation.

```{r, echo=FALSE}
ggplot(data = round_two_low, aes(x=Performance, y=Size, fill = Score)) +
  geom_jitter(aes(colour = Score), alpha = .8, size = 2) +
  labs(title = "Capsim Round 2 Low-Tech Perceptual Map") +
  xlim(0, 20) +
  ylim(0, 20)

```
```{r, echo=FALSE}
ggplot(data = round_seven_low, aes(x=Performance, y=Size, fill = Score)) +
  geom_jitter(aes(colour = Score), alpha = .8, size = 2) +
  labs(title = "Capsim Round 7 Low-Tech Perceptual Map") +
  xlim(0, 20) +
  ylim(0, 20)
```

When we compare the two plots, we observe that the products in the first graph have a higher survey score when closer to the point (5.8, 14.2) where as products in the second graph have a higher survey score when closer to the point (8.3, 11.7). As a general rule of thumb, customers expect products to have a higher performance and a smaller size as years pass.

One more aspect, there are actually two types of customers in Capsim:

* Low-tech
* High-tech

Each type of customer has its own ideal value.

```{r, echo = FALSE}
ggplot(data = round_seven_low, aes(x=Performance, y=Size, fill = Score)) +
  geom_jitter(aes(colour = Score), alpha = .8, size = 2) +
  labs(title = "Capsim Round 7 Low-Tech Perceptual Map") +
  xlim(0, 20) +
  ylim(0, 20)
```

```{r, echo= FALSE}
ggplot(data = round_seven_high, aes(x=Performance, y=Size, fill = Score)) +
  geom_jitter(aes(colour = Score), alpha = .8, size = 2) +
  labs(title = "Capsim Round 7 High-Tech Perceptual Map") +
  xlim(0, 20) +
  ylim(0, 20)
```

As we can see, high-tech customers demand a higher performance and smaller size than low-tech customers. In the same year, high-tech customers have an ideal value close to (12.3, 7.7) whereas the low-tech customers have an ideal value close to (8.3, 11.7). Additionally, each customer segment will value certain characteristics over others. For instance, the high-tech customers value performance and size while the low-tech customers value price.

### Product's Customer Survey Score

Calculating a product's customer survey score depends on the six characteristics outlined in the above section. The exact calculations is outlined in Capsim Foundation Team Member Guide. Each product is first assigned a base score for each of the following characteristics depending on how close the product's characteristic is to the ideal value:

* Price
* Performance and Size
* Reliability (Mean Time Before Failure)
* Age

The scores are then weighted according to which customer segment the product is targeted towards, and then the weighted scores are combined to form the product's raw score. The scores can range from 1 to 100.

Then the scores are weighted once more according the product's awareness and accessibility. If the product has 100% awareness and 100% accessibility, the product's base survey score does not change at all. Otherwise, the product's final score is calculated according to the following equation:

$$ Final = Initial * (1 - \frac{1 - awareness}{2}) * (1 - \frac{1 - accessibility}{2}) $$

